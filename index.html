<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>JP Rhyme Finder (Bo-in Rhyme Categorizer)</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0b0f18; --card:#111827; --text:#e6eeff; --muted:#95a3c3;
    --acc:#67e8f9; --acc2:#a78bfa; --line:rgba(255,255,255,.08);
  }
  *{box-sizing:border-box}
  body{margin:0;background:radial-gradient(1200px 600px at 20% -10%, #13203d 0%, #0b0e14 45%, #070a0f 100%);
       color:var(--text);font:500 15px/1.6 Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Hiragino Kaku Gothic ProN", Meiryo, sans-serif}
  header{padding:20px 18px 10px;display:flex;align-items:center;gap:12px;justify-content:space-between;flex-wrap:wrap}
  .brand{display:flex;gap:12px;align-items:center}
  .logo{width:40px;height:40px;border-radius:12px;background:conic-gradient(from 210deg, var(--acc), var(--acc2), var(--acc));box-shadow:0 0 24px rgba(110,231,255,.35), inset 0 0 30px rgba(255,255,255,.08)}
  h1{margin:0;font-size:18px}
  main{padding:8px 18px 28px;display:grid;grid-template-columns:1.1fr 1.4fr;gap:16px}
  @media(max-width:1000px){main{grid-template-columns:1fr}}
  .card{background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.00));border:1px solid var(--line);border-radius:16px;padding:14px 14px 16px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
  .card h2{margin:2px 0 10px;font-size:15px;color:#cfe2ff}
  label{display:block;margin:10px 0 6px;color:var(--muted);font-size:13px}
  input, textarea, select{width:100%;padding:11px 12px;border-radius:12px;border:1px solid var(--line);background:#0e1422;color:var(--text);outline:none;font-size:14px}
  textarea{min-height:100px;resize:vertical}
  .controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
  button{padding:10px 14px;border-radius:12px;border:1px solid var(--line);background:linear-gradient(180deg, #1a2236, #141b2b);color:var(--text);cursor:pointer}
  button:hover{transform:translateY(-1px)}
  .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .note{color:var(--muted);font-size:12px;margin-top:6px}
  .pill{display:inline-block;padding:4px 8px;border-radius:999px;border:1px solid rgba(255,255,255,.16);font-size:12px;color:#bde7ff;background:rgba(110,231,255,.12);}
  .section{margin-top:10px;border-top:1px dashed var(--line);padding-top:10px}
  .list{display:flex;flex-wrap:wrap;gap:8px}
  .chip{padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.12);background:#0e1626}
  .titleRow{display:flex;align-items:center;justify-content:space-between;gap:8px}
  .badge{font-size:12px;color:#a7ffea}
  .empty{opacity:.7}
</style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1>JP Rhyme Finder — 母音韻カテゴリ</h1>
        <div class="note">日本語ラップでよく使う「母音一致」をベースに、語尾パターンでカテゴリ分けして並べます。ひらがな/カタカナ推奨（漢字は読みが取れないため）。</div>
      </div>
    </div>
  </header>

  <main>
    <section class="card" aria-labelledby="config">
      <h2 id="config">入力</h2>
      <label for="word">キーワード（1語・読み推奨）</label>
      <input id="word" placeholder="例：むげん／ミライ／デプロイ／まるのうち" />

      <div class="grid-2">
        <div>
          <label for="depth">母音の比較長さ（1〜3）</label>
          <select id="depth">
            <option value="1">末尾1母音</option>
            <option value="2" selected>末尾2母音</option>
            <option value="3">末尾3母音</option>
          </select>
        </div>
        <div>
          <label for="limit">各カテゴリの最大件数</label>
          <select id="limit">
            <option>20</option>
            <option selected>40</option>
            <option>80</option>
            <option>200</option>
          </select>
        </div>
      </div>

      <div class="section">
        <div class="titleRow">
          <h3 style="margin:0;font-size:14px;color:#cfe2ff">辞書データ（任意）</h3>
          <span class="pill">貼り付けで拡張可</span>
        </div>
        <textarea id="custom" placeholder="1行1語で追加（かな/カナ推奨）。例：\nむげん\nかくめい\nしょうねん\nフロウ\nデプロイ\n"></textarea>
        <div class="note">※ 初期辞書は数百語のサンプル。ここに追加すると検索対象にマージされます。</div>
      </div>

      <div class="controls">
        <button id="run">韻をさがす</button>
        <button id="clear">クリア</button>
      </div>
    </section>

    <section class="card" aria-labelledby="outTitle">
      <div class="titleRow">
        <h2 id="outTitle">結果</h2>
        <div class="badge" id="summary">—</div>
      </div>
      <div id="results"></div>
      <div class="note section">カテゴリ：①完全母音一致／②2モーラ終端一致（かな）／③撥音・促音・長音近似／④外来語語尾（ション/ティオン/ーション等）。</div>
    </section>
  </main>

  <script src="https://unpkg.com/wanakana@5.2.0/dist/wanakana.min.js"></script>
  <script>
    // --- サンプル辞書（かな/カナ中心：母音抽出に強い） ---
    const BASE_DB = [
      // よく使う抽象語/ライム素材
      "むげん","げんせん","きけん","ぜんけい","しぜん","せんねん","しゅだん","ぶんめい","きぼう","みらい","けっか","げんじつ","かくめい","しこう","しゅうちゅう","たいりょく","てんかい","しょうねん","しょうじょ","しょうがい","じだい","きみ","こころ","ことば","おもい","ゆめ","せかい","ひかり","よる","あさ","かぜ","なみ","そら","ほし",
      // 動詞・形容
      "たたかう","まにあう","つながる","つくる","こわす","こえる","あげる","おとす","まわす","ならす","わらう","なく","さけぶ","うごく","ねむい","せつない","あぶない","やさしい","つよい","こわい","あつい","さむい","あおい","くらい","あかい",
      // 都市/場所
      "まるのうち","しぶや","しんじゅく","ぎんざ","とよす","とうきょう","よこはま","おおさか","なごや","ふくおか","さっぽろ","うめだ",
      // カタカナ外来語（語尾が揃いやすい）
      "フロウ","デプロイ","ドメイン","ドライブ","オンライン","オフライン","バイブス","セッション","エディション","ミッション","ビジョン","ヴァージョン","パッション","ソリューション","コミット","ブランチ","マージ","デバッグ","リファクタ","ホットフィックス","インスピレーション","インフォメーション","シチュエーション","ステーション","ビート","トラック","メロディ","ハーモニー","メッセージ","バージ","エモーション",
      // 擬音・合いの手
      "やー","よー","はっ","うー","あー","えい","おい","どーん",
      // 形態素っぽい接尾（語として扱う）
      "じゃない","みたい","みたいな","っぽい","らしい","らしく","らしさ","まじで","ほんと","だいたい","わりと","けっこう",
      // ラッパー的フレーズ素材
      "きょうも","あしたも","いつでも","どこでも","ここから","このまま","いまだけ","いまから","まだまだ","そろそろ","たぶん","ぜったい","まちがいない"
    ];

    // --- かな/カナ限定で母音列を抽出（漢字は読み不明のため非対応） ---
    const VOWELS = ['a','i','u','e','o'];
    function toRomajiSafe(s){
      // かな/カナはローマ字へ、英字はそのまま、漢字は削る
      const onlyKana = (s||'').replace(/[\u4e00-\u9faf]/g, ''); // 漢字除去
      return window.wanakana.toRomaji(onlyKana).toLowerCase();
    }
    function vowelTrail(roma, n=2){
      const vs = (roma.match(/[aeiou]+/g)||[]).join('');
      return vs.slice(-n);
    }
    function kanaTrail(s, mora=2){
      const kana = window.wanakana.toKana((s||'').replace(/[\u4e00-\u9faf]/g, ''));
      // 促音・長音・撥音も含めた末尾mora（ざっくり）
      const arr = Array.from(kana);
      return arr.slice(-mora).join('');
    }
    function categoryOf(word){
      // 末尾パターン簡易分類
      const w = (word||'').toString();
      if(/(ション|ティオン|ージョン|ジョン)$/.test(w)) return '外来語語尾(ション系)';
      if(/[んン]$/.test(w)) return '撥音(ん)で終わる';
      if(/[っッ]$/.test(w)) return '促音(っ)終わり';
      if(/[ー]$/.test(w)) return '長音(ー)終わり';
      return '一般語尾';
    }

    // --- 検索処理 ---
    const $ = (id)=>document.getElementById(id);
    const resultsEl = $('results');
    const summaryEl = $('summary');

    function parseCustomDB(){
      const rows = $('custom').value.split(/\n+/).map(s=>s.trim()).filter(Boolean);
      return rows;
    }

    function unique(arr){ return Array.from(new Set(arr)); }

    function search(){
      const q = $('word').value.trim();
      if(!q){ resultsEl.innerHTML = '<div class="empty">キーワードを入れてね（かな/カナ推奨）</div>'; summaryEl.textContent='—'; return; }

      const depth = parseInt($('depth').value,10);
      const limit = parseInt($('limit').value,10);

      const db = unique(BASE_DB.concat(parseCustomDB()));

      const romaQ = toRomajiSafe(q);
      const vtQ = vowelTrail(romaQ, depth);
      const ktQ = kanaTrail(q, 2);

      // 4カテゴリで集計
      const buckets = {
        '① 完全母音一致（末尾' + depth + '母音）': [],
        '② 2モーラ終端一致（かな）': [],
        '③ 撥音/促音/長音近似': [],
        '④ 外来語語尾（ション/ティオン等）': []
      };

      for(const w of db){
        const r = toRomajiSafe(w);
        const vt = vowelTrail(r, depth);
        const kt = kanaTrail(w, 2);
        const cat = categoryOf(w);

        // ① 完全母音一致
        if(vt && vt === vtQ) buckets['① 完全母音一致（末尾' + depth + '母音）'].push(w);
        // ② 2モーラ終端一致
        if(kt && ktQ && kt === ktQ) buckets['② 2モーラ終端一致（かな）'].push(w);
        // ③ 撥音/促音/長音近似（同カテゴリ同士で抽出）
        if((/[んン]$/.test(w) && /[んン]$/.test(q)) ||
           (/[っッ]$/.test(w) && /[っッ]$/.test(q)) ||
           (/[ー]$/.test(w) && /[ー]$/.test(q))){
          buckets['③ 撥音/促音/長音近似'].push(w);
        }
        // ④ 外来語語尾（ション系）
        if(/(ション|ティオン|ージョン|ジョン)$/.test(w) && /(ション|ティオン|ージョン|ジョン)$/.test(q)){
          buckets['④ 外来語語尾（ション/ティオン等）'].push(w);
        }
      }

      // 表示
      resultsEl.innerHTML = '';
      let total=0;
      Object.entries(buckets).forEach(([title, arr])=>{
        const uniq = unique(arr).filter(w=>w !== q).slice(0, limit);
        total += uniq.length;
        const wrap = document.createElement('div');
        wrap.className = 'section';
        wrap.innerHTML = `<div class="titleRow"><h3 style="margin:0 0 6px 0;font-size:14px;color:#cfe2ff">${title}</h3><span class="pill">${uniq.length}件</span></div>`;
        const list = document.createElement('div');
        list.className = 'list';
        uniq.forEach(w=>{
          const chip = document.createElement('div');
          chip.className = 'chip';
          chip.textContent = w;
          list.appendChild(chip);
        });
        if(uniq.length===0){
          const empty = document.createElement('div');
          empty.className = 'empty';
          empty.textContent = '該当なし';
          list.appendChild(empty);
        }
        wrap.appendChild(list);
        resultsEl.appendChild(wrap);
      });

      summaryEl.textContent = `総計 ${total} 件 / 深さ: 母音${depth}`;
    }

    $('run').addEventListener('click', search);
    $('clear').addEventListener('click', ()=>{
      $('word').value=''; $('custom').value=''; resultsEl.innerHTML=''; summaryEl.textContent='—';
    });

    // Enterキーで検索
    $('word').addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); search(); }});
  </script>
</body>
</html>
